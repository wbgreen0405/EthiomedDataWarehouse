{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.2", "generated_at": "2025-06-27T19:17:33.628692Z", "invocation_id": "01dbf7ef-2370-43bb-bb9d-efe7453be03b", "invocation_started_at": "2025-06-27T19:17:20.693142Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-27T19:17:32.081988Z", "completed_at": "2025-06-27T19:17:32.111491Z"}, {"name": "execute", "started_at": "2025-06-27T19:17:32.112497Z", "completed_at": "2025-06-27T19:17:32.601724Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.5237812995910645, "adapter_response": {"_message": "SELECT 1858", "code": "SELECT", "rows_affected": 1858}, "message": "SELECT 1858", "failures": null, "unique_id": "model.ethio_medical_project.ethio_medical", "compiled": true, "compiled_code": "-- models/ethio_medical.sql\n\n\nWITH source_data AS (\n    SELECT *\n    FROM \"postgres\".\"public\".\"ethio_medical\"  -- Use DBT's source function\n)\n\nSELECT\n    channel_id,\n    channel_title,\n    lower(channel_username) AS channel_username,\n    message_id,\n    \"message\", -- Assuming you've already changed this to lowercase 'message'\n    date,\n    media_path\nFROM source_data\nWHERE \"message\" IS NOT NULL\n-- Remove the semicolon from the line below:\nAND media_path IS NOT NULL", "relation_name": "\"postgres\".\"public\".\"ethio_medical\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-27T19:17:32.101984Z", "completed_at": "2025-06-27T19:17:32.118496Z"}, {"name": "execute", "started_at": "2025-06-27T19:17:32.131627Z", "completed_at": "2025-06-27T19:17:32.801523Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.7040598392486572, "adapter_response": {"_message": "SELECT 1689", "code": "SELECT", "rows_affected": 1689}, "message": "SELECT 1689", "failures": null, "unique_id": "model.ethio_medical_project.transformed_medical_product", "compiled": true, "compiled_code": "\n\nWITH source_data AS (\n    SELECT *\n    FROM \"postgres\".\"public\".\"ethio_medical\"\n),\nphone_extracted AS (\n    SELECT\n        channel_id,\n        message_id,\n        channel_title,\n        lower(channel_username) AS channel_username,\n        \"message\", -- Ensure this is lowercase\n        date,\n        media_path,\n        array_to_string(ARRAY(\n            SELECT regexp_replace(unnest(regexp_matches(\"message\", '09\\s*[0-9]{8}', 'g')), '\\s+', '', 'g')\n        ), ', ') AS phone_numbers,\n        regexp_replace(\n            \"message\",\n            '09\\s*[0-9]{8}',\n            '',\n            'g'\n        ) AS cleaned_message\n    FROM source_data\n),\nproduct_price_extracted AS (\n    SELECT\n        channel_id,\n        message_id,\n        channel_title,\n        channel_username,\n        date,\n        TRIM(cleaned_message) AS cleaned_message,\n        phone_numbers,\n        regexp_matches(cleaned_message, '^(.*?)\\s*(?:price|Price|PRICE)\\s*(\\d+)\\s*(birr|ETB)', 'g') AS matches,\n        media_path,\n        ROW_NUMBER() OVER (PARTITION BY message_id ORDER BY date DESC) AS rn\n    FROM phone_extracted\n)\n\nSELECT\n    channel_id,\n    message_id AS product_id,\n    channel_title,\n    channel_username,\n    date,\n    TRIM(matches[1]) AS product_name,\n    CAST(TRIM(matches[2]) AS INTEGER) AS price_in_birr,\n    media_path,\n    CASE\n        WHEN phone_numbers IS NOT NULL AND phone_numbers != '' THEN phone_numbers\n        ELSE NULL\n    END AS contact_phone_numbers,\n    cleaned_message AS message -- ADD THIS LINE to output the 'message' column\nFROM product_price_extracted\nWHERE matches IS NOT NULL\nAND rn = 1\nAND TRIM(matches[1]) <> ''\nAND TRIM(matches[1]) <> TRIM(matches[2])\nORDER BY message_id", "relation_name": "\"postgres\".\"public\".\"transformed_medical_product\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-27T19:17:32.828708Z", "completed_at": "2025-06-27T19:17:32.853866Z"}, {"name": "execute", "started_at": "2025-06-27T19:17:32.862679Z", "completed_at": "2025-06-27T19:17:33.172557Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.3538804054260254, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": "SELECT 1", "failures": null, "unique_id": "model.ethio_medical_project.transformed_channel", "compiled": true, "compiled_code": "-- models/transformed_channel.sql\n\n\nWITH source_data AS (\n    SELECT\n        channel_id,\n        channel_username,\n        channel_title\n    FROM \"postgres\".\"public\".\"transformed_medical_product\" -- CHANGE THIS LINE\n    WHERE contact_phone_numbers IS NOT NULL AND contact_phone_numbers != ''\n)\n\nSELECT DISTINCT ON (channel_id)\n    channel_id,\n    channel_username,\n    channel_title\nFROM source_data", "relation_name": "\"postgres\".\"public\".\"transformed_channel\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-27T19:17:32.842806Z", "completed_at": "2025-06-27T19:17:32.876320Z"}, {"name": "execute", "started_at": "2025-06-27T19:17:32.879884Z", "completed_at": "2025-06-27T19:17:33.256900Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.43119120597839355, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": "SELECT 1", "failures": null, "unique_id": "model.ethio_medical_project.transformed_contact_number", "compiled": true, "compiled_code": "-- models/transformed_contact_number.sql\n\n\nWITH source_data AS (\n    SELECT\n        channel_id,\n        contact_phone_numbers\n    FROM \"postgres\".\"public\".\"transformed_medical_product\" -- CHANGE THIS LINE\n    WHERE contact_phone_numbers IS NOT NULL AND contact_phone_numbers != ''\n)\n\nSELECT DISTINCT ON (channel_id)\n    channel_id,\n    contact_phone_numbers\nFROM source_data", "relation_name": "\"postgres\".\"public\".\"transformed_contact_number\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-27T19:17:32.855868Z", "completed_at": "2025-06-27T19:17:32.893469Z"}, {"name": "execute", "started_at": "2025-06-27T19:17:32.898471Z", "completed_at": "2025-06-27T19:17:33.325942Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.4861490726470947, "adapter_response": {"_message": "SELECT 1689", "code": "SELECT", "rows_affected": 1689}, "message": "SELECT 1689", "failures": null, "unique_id": "model.ethio_medical_project.transformed_product", "compiled": true, "compiled_code": "-- models/transformed_product.sql\n\n\nWITH source_data AS (\n    SELECT\n        product_id,\n        product_name, -- ADDED: Ensure this is selected from transformed_medical_product\n        price_in_birr,\n        channel_id,\n        -- Assuming 'date' is also available in transformed_medical_product\n        date -- Ensure this column exists in transformed_medical_product\n    FROM \"postgres\".\"public\".\"transformed_medical_product\" -- CRITICAL CHANGE: Use ref() not source()\n)\n\nSELECT\n    product_id,\n    product_name, -- ADDED: Ensure this is here\n    price_in_birr,\n    channel_id,\n    date\nFROM source_data\n-- Add any specific transformations or filters for transformed_product here", "relation_name": "\"postgres\".\"public\".\"transformed_product\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-06-27T19:17:32.871211Z", "completed_at": "2025-06-27T19:17:32.904112Z"}, {"name": "execute", "started_at": "2025-06-27T19:17:32.910519Z", "completed_at": "2025-06-27T19:17:33.469289Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.617945671081543, "adapter_response": {"_message": "SELECT 1689", "code": "SELECT", "rows_affected": 1689}, "message": "SELECT 1689", "failures": null, "unique_id": "model.ethio_medical_project.transformed_product_images", "compiled": true, "compiled_code": "-- models/transformed_product_images.sql\n\n\nWITH source_data AS (\n    SELECT\n        product_id, -- CHANGED FROM message_id TO product_id\n        media_path\n    FROM \"postgres\".\"public\".\"transformed_medical_product\"\n    WHERE media_path IS NOT NULL AND media_path != ''\n)\n\nSELECT\n    product_id, -- CHANGED FROM message_id TO product_id\n    media_path AS image_path\nFROM source_data", "relation_name": "\"postgres\".\"public\".\"transformed_product_images\"", "batch_results": null}], "elapsed_time": 2.632202625274658, "args": {"log_format": "default", "quiet": false, "vars": {}, "warn_error_options": {"error": [], "warn": [], "silence": []}, "which": "run", "introspect": true, "select": [], "macro_debugging": false, "validate_macro_args": false, "version_check": true, "project_dir": "C:\\Users\\dsksw\\Documents\\EthiomedDataWarehouse\\ethio_medical_project", "show_resource_report": false, "log_path": "C:\\Users\\dsksw\\Documents\\EthiomedDataWarehouse\\ethio_medical_project\\logs", "skip_nodes_if_on_run_start_fails": false, "cache_selected_only": false, "printer_width": 80, "log_format_file": "debug", "exclude": [], "state_modified_compare_vars": false, "log_level_file": "debug", "strict_mode": false, "empty": false, "partial_parse_file_diff": true, "indirect_selection": "eager", "use_colors_file": true, "use_fast_test_edges": false, "require_all_warnings_handled_by_warn_error": false, "favor_state": false, "invocation_command": "dbt run --full-refresh", "partial_parse": true, "print": true, "send_anonymous_usage_stats": true, "profiles_dir": "C:\\Users\\dsksw\\.dbt", "defer": false, "show_all_deprecations": false, "source_freshness_run_project_hooks": true, "upload_to_artifacts_ingest_api": false, "require_yaml_configuration_for_mf_time_spines": false, "populate_cache": true, "require_nested_cumulative_type_params": false, "state_modified_compare_more_unrendered_values": false, "require_batched_execution_for_custom_microbatch_strategy": false, "static_parser": true, "use_colors": true, "require_resource_names_without_spaces": true, "full_refresh": true, "log_file_max_bytes": 10485760, "write_json": true, "log_level": "info", "require_explicit_package_overrides_for_builtin_materializations": true}}